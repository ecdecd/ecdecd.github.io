const novels = {
    novel1: {
        title: "Assay Detective 分析侦探",
        chapters: {
1: {
  title: "Prologue",
  quote: "人类是标签，是数据，是堆叠代码编织而成的记忆。",
  content: "<p>主菜是伊卡洛斯之蜡，佐以阿基米德圆派。看似有什么传承千年、基于神话或历史的典故，实则和提及的角色名字没有任何关系，巧妙又无用的营销手段。</p><p>一个人享用目的并非维持生命体征的晚餐，随后继续翻阅昨天没读完的书，本该是完美的安排。</p><p>“人类是标签，是数据，是堆叠代码编织而成的记忆。”咏叹似的语调，在我家听到可以直接视作噪音。</p><p>“不拿书的话就从我的书柜旁边离开。”我自己都还没解决晚餐进展到去读书的步骤。</p><p>这家伙出现得不是时候，不过我也不意外。</p><p>拿着我家的钥匙就肆无忌惮地看心情来访，连主人都不知会，丝毫没有这是“我家”的自觉。</p><p>黑间就是这样的人。</p><p>“今天晚上我吃了派哦。”</p><p>从我无法理解的接近“哲学”的感慨直接转到日常，在等待我说出“呀，好巧，我也是”吗。站在那里只要退一步就可以看见餐厅位置的我在吃什么，比起他真的吃了派，更大的可能是绞尽脑汁才编造出的虚假共同话题，可悲。</p><p>“因为无论如何都会融化，所以搭配完美的圆周。”</p><p>一边随手拂过排列整齐的书脊，一边对我的晚餐指指点点起来。我并不知道这句话的因果关系存在于何处。</p><p>“怎么这个时候过来？”</p><p>“钥匙给我还说了‘随时’可以来，那我不就随时来了嘛。”</p><p>我走到他身侧。他终于挑挑拣拣抽出了一本书，没有要看的意图，只是捏在手里。</p><p>“《化学原理》？”封面我很熟悉。</p><p>“是啊，你这里怎么会有这种书？”</p><p>“我书柜里的内容从来不固定。”你最好给我说清楚“这种”是哪种。</p><p>“那也不是看这玩意的理由啊。哪里能用得上？”</p><p>“当消遣罢了。”</p><p>“我怎么没听说咱们伟大的侦探海松还有看闲书的余裕？”</p><p>“当下没有应用领域就叫闲书的话，你这个闲人能不能从我眼前消失啊。”哪里来的花里胡哨的前缀。</p><p>“就算是我听到这种话也会受伤的哦？”</p><p>“那就受着。”</p><p>“就是因为你这种态度才会完全没有回头客啊。说起来有那种‘容易得罪人’的标签吗？”</p><p>我实在看不下去这家伙拿着我的书在指尖旋转，没好气地把书夺回来：“你有没有这个标签你自己不清楚？”</p><p>“那看来是没有了，真遗憾啊，要是能挂着就不会有奇怪的人来搭话了吧。”</p><p>“反而会有更多奇怪的家伙。”</p><p>“变态吸引变态就是这么回事。”</p><p>“相似相溶。”</p><p>“欸，是化学的词吗？”</p><p>“哇，你居然知道。”</p><p>“这么平静的语气说出来我又会当成嘲讽的啊。”</p><p>不要误会，这就是实打实的嘲讽。</p><p>他夸张地推了推装饰性的眼镜，随即指向我手里的书：“简单的推理，我当然不知道化学——不属于常识又被你说出来的词，还有闲书内容之外的可能性吗？”</p><p>“不要老是卖弄那套侦探的学说……把戏。”没有反驳的立场，超常识内容我确实只了解过化学。</p><p>“相似相溶，相、似、相、溶……”占据了我座位的家伙还在一字一顿地咀嚼着这个词。</p><p>“极性分子间的关系。极性易溶于极性，非极性易溶于非极性。别老是念叨了，我不会再解释极性是什么的。”</p><p>“你在说绕口令吗？不要说得跟我不会自己查一样——”</p><p>“呵，对用不上的东西感兴趣了吗？”</p><p>“啊，找到了。嗯嗯，只是对不对称的问题嘛，这我还是能理解的。”</p><p>“分子的部分呢。”</p><p>“啊？什么分子？”</p><p>“还是化学的词，不必深究。”这家伙绝对没有理解。</p><hr><p>我当然知道和人讨论化学是白费口舌。“化学”——基础教育的边缘，作为自然科学的分支顺带提及，已经被剔除出基础常识数据的部分。在CELL里找一百个人询问，恐怕会有九十九个连“元素周期表”这个名词都感到陌生吧。已经习惯了依赖CELLS，愿意动用“记忆”去承载这些公认的无用数据的人可不多。</p><p>很不幸，我不得不去记忆。记忆“化学”，记忆“元素周期表”，记忆……“元素”。</p><p>与稳定性紧密相关的“元素”。</p><p>可以说是与工作有关。</p><p>在AI仍在努力向人类靠近的同时，人类愈发千奇百怪——从外形到精神状态。偶尔我会怀疑标签的时效性，按月更新是不是赶不上变化的速度。不过更高层次的决断不是我一介草民能置喙的，这是我工作的基础，只要不到影响工作的程度，怎样都好。</p><p>不知何故出现、常见而危险的标签，“不稳定”。我的工作就是找到携带这个标签的个体，并使用必要的手段解决。可能是解决标签，可能是……解决这个个体。</p><p>可以叫程序员，可以叫分析师。修补社会的漏洞，分析人类的精神。</p><p>黑间这小子还说我看闲书，自己不知看了多少乱七八糟的小说，给我和他自己硬扣了侦探和助手的帽子，我也懒得次次去反对。</p><p>既然勉强算是侦探，就得有独家侦察情报：流窜在CELL中的若干非法数据——经过我曾经粗糙的紧急补习，最终确定为元素。当然，之后验证了这个结论。</p><p>化学元素的某些特质（在CELL外叫做物理性质和化学性质）如何与人类的状态息息相关，这是我选择分析的课题。</p><p>不过到底是程序被人为植入了不该存在的东西、AI不为人知的叛逆、还是那些元素从古至今一直在人类社会中隐秘地穿梭，我没办法给出定论。</p><p>我接受委托，处理标签，仅此而已。</p><p>不需要劳动力就能随心所欲运转的乌托邦，“选择”、“工作”这两个词并列本身就是特权的一部分。</p><p>我是被元素选中的人吗？还是我选择了元素呢。</p><hr><p>我曾经遭遇过元素。</p><p>读起来像是“发生了遭遇战”、“遭遇了险情”的句子，并不是这种有攻击性的意思。更接近纯粹的、中性的自然现象——存在，并且被偶然路过的人类注意到。</p><p>“——我是硅。014。”</p><p>那个元素是这样说的。</p><p>那个时候的我还对化学一无所知。</p><p>CELL内化学并不成立，当然不需要作为常识数据。道理很简单，连原子都不存在，基于原子水平的研究自然无从展开。我汲取的知识只是镜花水月、空中楼阁，文字影像资料数据仅能作为参考，不存在的就是不存在。</p><p>即使是硅，我对他的了解也仅限于那段短暂的相处时光，以及此后对第14号元素相关资料的阅览了。</p><p>要是哪天到CELL外去看一眼——这样危险的想法还是到此为止比较好。</p><hr><p>“啊！”</p><p>“一惊一乍干什么呢。”</p><p>“有人擅自跑出CELL了，今天。”</p><p>“不就是有人擅自——等一下。注意措辞，可没有‘擅自’离开的说法，我们都有自由进出的权利。”</p><p>“没人跟你抠字眼啦。没有上新闻，不过我得到了这个消息哦。”</p><p>“那么请问您是在哪里看到的呢，消息比新闻记者还灵通的黑间同学？”</p><p>“……不重要、不重要。这小子绝对有问题，大概马上就会接到委托了吧。”</p><p>“来我家的目的？”不管别人有没有问题，你这家伙绝对有问题。带着我要的消息找上门来还不及时说，现在才突然想起来，这种助手真的有必要吗……唉，被他带沟里去了，他才不是我的助手。</p><p>“好像是……又好像不是。嘿嘿，忘了。”</p><p>“你最好没有别的忘记的事情。”</p><p>“哦哦，来了，菲尔艺术工作室的第二笔单子——”</p><p>“怎么这才第二笔。”也就是说上次才算开张营业吗。</p><p>“——Γ区的标签管理局？哇，惊动了官方呢。”</p><p>“已经看到了才告诉我‘马上’的预言是吧，了不起。”</p><p>什么时候这家伙才能想起来我就是标签管理局的……外聘人员不作数，好吧，好吧。</p><p>“没有说明时限，不过肯定有尽快的意思在，怎么说，和上次一样吗？”</p><p>“再快现在也不是工作时间。你差不多该从我的位置上起来了吧？”不要说执行原定看书的计划了，我连要看的书都还没拿出来。</p><p>“哇，黑心侦探不让助手落座，下次换个人跟咯。”</p><p>“最好是直接把你自己换掉。”再给他三句话的机会，无论如何我都要送客了。</p><p>“你说距离我自立门户成为侦探还需要多少时间？”</p><p>“再不让开这辈子没指望了。”三。</p><p>“这辈子就到此为止了么，好可怕好可怕。”</p><p>“……明天六点，Γ区的区界点见。”二。</p><p>“容我最后一问，是早上六点吗？”</p><p>“你要是敢下午再来这个工作室就准备解散吧。”一。</p><p>在我下发逐客令之前，他终于临时觉醒了察言观色的天赋，一眨眼从我家离开了。</p><p>真要走的时候倒和来时一样利索。</p><p>只可惜书今天恐怕是看不了了，我还得仔细看看这份委托的内容。说是让黑间这家伙帮我转接处理业务，就真的只是接收、像这样草率地念一下发件人和大方位的话，下次还是我自己收好了。</p><p>“猫的、目击证明啊……”</p>"
},
2: {
  title: "C1 K 无业游民",
  quote: "只要忘记元素就可以稳定下来——我很想这样说。太遗憾了，根本不是这个问题。",
  content: "<p>“只要忘记元素就可以稳定下来——我很想这样说。太遗憾了，根本不是这个问题。”</p>"
},
3: {
  title: "C1 L 不辞而别",
  quote: "那也能叫猫？你都比它长得像猫。",
  content: "<p>“那也能叫猫？你都比它长得像猫。”</p>"
},
4: {
  title: "C3 K",
  quote: "你比我看起来更像医生。",
  content: "<p>“你比我看起来更像医生。”</p>"
},
        }
    },
    novel2: {
        title: "废物限定召唤",
        chapters: {
1: {
  title: "好像不是我的问题",
  quote: "不要觉得被支持的一定是好人啦。",
  content: "<p>纸张上的粘贴物因年岁而稍有脱落迹象，看得出若是没有主人的精心呵护，这本本子的实际寿命只会更短。</p><p>报纸并不是什么随处可见的物资，至少在最近不是。能够订阅报纸并恣意裁切粘贴，这些资料的收集者恐怕与我们并不属于一个阶层。</p><p>“是的，我是他的支持者。”在这本本子的末页，他用平淡的语调陈述了一个显而易见的事实。</p>"
},
        }
    },
    novel3: {
        title: "被遗弃的故事们",
        chapters: {
1: {
  title: "废物限定召唤",
  quote: "你骂谁废物呢？",
  content: "<p>死亡是永恒的宁静。</p><p>前提是没有人把我召唤出来。</p><p>到底是复活还是重生已经不重要了……离开了无法计量时间空间的黑暗，睁眼看到的就是若干匍匐于我所在高台下的人们。</p><p>“勇者大人——”</p><p>他们这样虔诚地呼唤着。</p><p>救命。</p><p>我该怎么解释……</p><p>我绝对不是他们想要召唤的勇者。</p>"
},
        }
    },
    novel4: {
        title: "设定记录",
        chapters: {
1: {
  title: "人类记录",
  quote: "谁？",
  content: "<h3>海松</h3><p>冷眼旁观的程序员。</p><h3>黑间·菲尔</h3><p>随心所欲的乐天派。</p><h3>楊枝修司 ようじしゅうじ</h3><p>精打细算的工程师。</p><h3>忌野春名 いまわのはるな</h3><p>吃喝玩乐的逃避者。</p><h3>“缓行”特罗弗拉 Trovra the Ambler</h3><p>背负背叛的背德者。</p><h3>季荧</h3><p>困于过往的雕刻家=血泪自由的追寻者。</p>"
},
        }
    },
};

let currentNovel = 'novel1';
let currentChapter = 1;
let sidebarVisible = false;
let settingVisible = false;

function loadChapter() {
    const chapter = novels[currentNovel].chapters[currentChapter];
    if (chapter) {
        document.getElementById('novelText').innerHTML = chapter.content;
        document.getElementById('chapterTitle').innerText = chapter.title;
        document.getElementById('chapterQuote').innerText = chapter.quote;
        document.getElementById('novelTitle').innerText = novels[currentNovel].title;
        // 统计字数
        calculateStats(chapter.content);
    } else {
        document.getElementById('novelText').innerText = "章节不存在。";
    }
    updateChapterList();
    updateNavButtons();
    updateScrollToTopButton();
}

function updateChapterList() {
    const chapterList = document.getElementById('chapter');
    chapterList.innerHTML = ""; // 清空旧的章节
    const chapterKeys = Object.keys(novels[currentNovel].chapters);

    chapterKeys.forEach(key => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = "#";
        a.innerText = `${novels[currentNovel].chapters[key].title}`;
        //a.innerText = `第 ${key} 章 - ${novels[currentNovel].chapters[key].title}`;
        a.setAttribute('data-chapter', key);
        a.onclick = (e) => {
            e.preventDefault();
            currentChapter = parseInt(key);
            loadChapter();
        };
        li.appendChild(a);
        chapterList.appendChild(li);
    });
}

function updateNavButtons() {
    const prevButton = document.getElementById('prevChapter');
    const nextButton = document.getElementById('nextChapter');

    const totalChapters = Object.keys(novels[currentNovel].chapters).length;

    prevButton.style.display = currentChapter > 1 ? 'inline' : 'none';
    nextButton.style.display = currentChapter < totalChapters ? 'inline' : 'none';
}

function updateScrollToTopButton() {
    const scrollToTopButton = document.getElementById('scrollToTop');
    scrollToTopButton.style.display = window.scrollY > 200 ? 'inline' : 'none'; // 滚动200px时显示
}

document.getElementById('novelSelect').addEventListener('change', (event) => {
    currentNovel = event.target.value;
    currentChapter = 1;
    loadChapter();
});

document.getElementById('prevChapter').addEventListener('click', () => {
    if (currentChapter > 1) {
        currentChapter--;
        loadChapter();
    }
});

document.getElementById('nextChapter').addEventListener('click', () => {
    if (currentChapter < Object.keys(novels[currentNovel].chapters).length) {
        currentChapter++;
        loadChapter();
    }
});

document.getElementById('fontSize').addEventListener('input', (event) => {
    document.getElementById('novelText').style.fontSize = event.target.value + 'px';
});

document.getElementById('fontFamily').addEventListener('change', (event) => {
    document.getElementById('novelText').style.fontFamily = event.target.value;
});

document.getElementById('bgColor').addEventListener('input', (event) => {
    document.body.style.backgroundColor = event.target.value;
});

document.getElementById('scrollToTop').addEventListener('click', () => {
    window.scrollTo(0, 0);
});

// 初始化加载章节
loadChapter();

// 目录悬浮按钮
document.getElementById('toggleSidebar').addEventListener('click', () => {
    sidebarVisible = !sidebarVisible;
    document.getElementById('sidebar').style.display = sidebarVisible ? 'block' : 'none';
});

// 设置悬浮按钮
document.getElementById('toggleSetting').addEventListener('click', () => {
    settingVisible = !settingVisible;
    document.getElementById('setting').style.display = settingVisible ? 'block' : 'none';
});

// 监听键盘事件
document.addEventListener('keydown', (event) => {
    if (event.key === 'ArrowLeft') {
        if (currentChapter > 1) {
            currentChapter--;
            loadChapter();
        }
    } else if (event.key === 'ArrowRight') {
        if (currentChapter < Object.keys(novels[currentNovel].chapters).length) {
            currentChapter++;
            loadChapter();
        }
    }
});

// 监听页面滚动
window.addEventListener('scroll', updateScrollToTopButton);

// dark
document.getElementById('darkButton').addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    document.getElementById('sidebar').classList.toggle('dark-mode');
    document.getElementById('setting').classList.toggle('dark-mode');
});

// 计算字数和阅读时间
function calculateStats(content) {
    const text = content.replace(/<[^>]*>/g, ''); // 移除 HTML 标签
    const chineseCharacters = text.match(/[\u4e00-\u9fa5]/g) || [];// 统计中文字符
    const numbers = text.match(/\d+/g) || [];// 统计数字
    const englishWords = text.match(/[a-zA-Z]+/g) || [];// 统计英文单词
    const totalCount = chineseCharacters.length + numbers.length + englishWords.length;// 总字数
    const readingSpeed = 450; // 每分钟300个字符的阅读速度
    const readingTime = Math.ceil(totalCount / readingSpeed);
    document.getElementById('stats').innerText = `本章字数： ${totalCount} 字 丨 估计阅读时间： ${readingTime} 分钟`;
}
